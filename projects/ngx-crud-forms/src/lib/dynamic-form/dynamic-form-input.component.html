<div class="form-group dynamic-form-input" [formGroup]="form"
    *ngIf="!input.hidden && !(input.hideOnCreate && isNewModel)">
    <label [attr.for]="input.key">{{input.header}}</label>

    <div [ngSwitch]="input.controlType">
        <input *ngSwitchCase="'textbox'" class="form-control" [formControlName]="input.key" [id]="input.key"
            [type]="input.type" [ngStyle]="input.style">

        <textarea *ngSwitchCase="'textarea'" class="form-control" [formControlName]="input.key" [id]="input.key"
            [cols]="input.cols" [ngStyle]="input.style" [rows]="input.rows"></textarea>

        <input *ngSwitchCase="'file'" class="form-control" [type]="input.type" [ngStyle]="input.style" [id]="input.key"
            (change)="onFileChange($event)" />

        <div *ngSwitchCase="'multipleFile'">
            <input class="form-control" [type]="input.type" [ngStyle]="input.style" [id]="input.key" multiple
                (change)="onMultipleFileChange($event)" />
            <p *ngIf="this.form.get(input.key).value && this.form.get(input.key).value.length > 0" class="mb-0">
                Current files:</p>
            <ul>
                <li *ngFor="let file of this.form.get(input.key).value; let i = index;" class="mb-1">
                    {{ file.name }}
                    <button class="btn btn-sm btn-danger" (click)="deleteFromFileList(input.key, i)">Delete</button>
                </li>
            </ul>
        </div>

        <div *ngSwitchCase="'dropdown'">
            <ng-select *ngIf="input.linkedObject" [addTag]="true" addTagText="Add" [items]="input['allValues']"
                [multiple]="input['multipleSelect']" [closeOnSelect]="false" [ngStyle]="input.style"
                [searchable]="false" [bindLabel]="input.linkedData['value']" placeholder="Select ..."
                [formControlName]="input.key">
            </ng-select>

            <select *ngIf="!input.linkedObject" [id]="input.key" [formControlName]="input.key" class="form-control">
                <option *ngFor="let opt of input['options']" [value]="opt.key">{{opt.value}}</option>
            </select>
        </div>
        <p-calendar *ngSwitchCase="'calendar'" [formControlName]="input.key" dateFormat="yy-mm-dd" [showIcon]="true"
            [ngStyle]="input.style"></p-calendar>

        <div *ngSwitchCase="'radio'">
            <div *ngFor="let opt of input['options']" class="form-check form-check-inline">
                <input [name]="input.key" value="{{opt.key}}" [formControlName]="input.key" class="form-check-input"
                    [type]="'radio'" [checked]="input.value == opt.key" [ngStyle]="input.style">
                <span class="form-check-label" [ngStyle]="input.style">{{opt.value}}</span>
            </div>
        </div>

        <div *ngSwitchCase="'checkbox'">
            <input [id]="input.key" [formControlName]="input.key" class="form-control" type="checkbox"
                [ngStyle]="input.style">
        </div>

        <div *ngSwitchCase="'videochapter'">
            <ng-container [formArrayName]="input.key">
                <div class="row mt-2" *ngFor="let item of this.form.get(input.key)['controls']; let i = index;">
                    <ng-container [formGroupName]="i">
                        <input type="number" hidden class="form-control" formControlName="id">
                        <div class="col-md-3 pr-1">
                            <input type="text" class="form-control" formControlName="timestamp" placeholder="Timestamp">
                        </div>
                        <div class="col-md-6 pl-1 pr-1">
                            <input type="text" class="form-control" formControlName="title" placeholder="Chapter title">
                        </div>
                        <div class="col-md-2 pl-1 my-auto">
                            <button class="btn btn-sm btn-danger"
                                (click)="deleteVideoChapter(input.key, i)">Delete</button>
                        </div>
                    </ng-container>
                    <br>
                    <small class="text-danger ml-3" *ngIf="this.form.get(input.key)['controls'][i].invalid">
                        Timestamp must be in MM:SS format.
                    </small>
                </div>
            </ng-container>

            <button class="btn btn-sm btn-success mt-2" (click)="addVideoChapter(input.key)">Add chapter</button>
        </div>
    </div>

    <small class="text-danger" *ngIf="!input.required? false : !isValid">{{input.header}} is required</small>
</div>